(ns advent-2024.day-10
  (:require [advent.util :as util]
            [clojure.string :as str]))


(defn parse [s]
  (into []
        (map (fn [l]
               (into []
                     (map (fn [c]
                            (Character/digit ^char c 10)))
                     l)))
        (str/split-lines s)))


(defn trails
  ([in]
   (trails in (map identity)))
  ([in path-xf]
   (into []
         (comp (filter (fn [p]
                         (zero? (get-in in p))))
               (mapcat (fn [root]
                         (into []
                               (comp (filter (fn [p]
                                               (= 9 (get-in in p))))
                                     path-xf)
                               (tree-seq (constantly true)
                                         (fn [pos]
                                           (let [v (get-in in pos)
                                                 v' (inc v)]
                                             (filter (fn [pos']
                                                       (= v' (get-in in pos')))
                                                     (util/taxi-neighbors in pos))))
                                         root)))))
         (util/rect-points in))))


(defn part-1 [in]
  (count (trails in
                 (distinct))))


(defn part-2 [in]
  (count (trails in)))


(comment
  (def t "89010123\n78121874\n87430965\n96549874\n45678903\n32019012\n01329801\n10456732")
  (def in "21056789894321015012980123498787601045687\n32346543765601156703474544567896012138796\n10107632659892349821563678989345643029655\n23218101256781015430412101071234754910544\n14569870345432016321003012560109867801033\n05678963256789127879854303456078105932122\n18723450109898038910765210010563254541001\n69011201298788945125898998323454569679852\n78760345345654876034787677401235378089760\n89456896012503876965014586512765432123601\n32387987003412965872123298703890101984512\n01291876121101234989456107654965278854603\n00180145030980325678327890217874369763254\n14343232145671013454310691307893454610169\n23432165430110302169234582456732108905678\n96547078923231231078105673454321097214523\n87678432214348940987017894765870986341014\n96589541009857654320123765891963475498765\n01434630111766789010432143210452560167876\n32345721210951999016549054789301001456965\n21076890129810878321678945643219812332109\n78789001234723765430321238756106734323458\n09654160345654210389210109987005125010767\n12323271657601345678780125678014056541893\n25414987798542343456690034329123987932012\n56905677810439652987501145016510345801101\n67856298923128721987432156987421256789210\n22347107654098910876543087870330107654301\n11298231012347654305678898981278798987652\n00109545691056763211219767874569678690343\n12065456783345894320105656913450569541289\n43874321092132101899234541002321256632176\n54930010561001234788765432211056746789045\n67821123472390545654123101347849839874330\n78934010589487698763034567456931028765221\n67785697696590101672105698741022210540100\n58696788787781234589789789012013307632101\n49545459810170301075674654323454458989032\n30432365923965432165463210498569567976543\n21021876854876523678354112347678678875301\n30010966763987014589210001456565589765432")


  (part-1 (parse in))
  (part-2 (parse in))

  )
