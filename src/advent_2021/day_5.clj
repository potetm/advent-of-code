(ns advent-2021.day-5
  (:require
    [advent.util :as util]
    [clojure.string :as str]))

(defn parse [in]
  (map (fn [l]
         (into []
               (comp (map #(Long/parseLong %))
                     (partition-all 2)
                     (map vec))
               (re-seq #"\d+" l)))
       (str/split-lines in)))


(defn line-pnts [pnts]
  (let [[[x1 y1] [x2 y2]] (sort pnts)]
    (if (= x1 x2)
      (map (fn [y]
             [x1 y])
           (range y1 (inc y2)))
      (let [m (/ (- y1 y2)
                 (- x1 x2))
            b (- y1 (* m x1))]
        (map (fn [x]
               [x (+ (* m x)
                     b)])
             (range x1
                    (inc x2)))))))


(def intersecting-pnts-xform
  (comp (mapcat line-pnts)
        (util/duplicates)))


(defn part-1 [dat]
  (count (into []
               (comp (filter (fn [[[x1 y1] [x2 y2]]]
                               (or (= x1 x2)
                                   (= y1 y2))))
                     intersecting-pnts-xform)
               dat)))


(defn part-2 [dat]
  (count (into []
               intersecting-pnts-xform
               dat)))

(comment
  (def tin "0,9 -> 5,9\n8,0 -> 0,8\n9,4 -> 3,4\n2,2 -> 2,1\n7,0 -> 7,4\n6,4 -> 2,0\n0,9 -> 2,9\n3,4 -> 1,4\n0,0 -> 8,8\n5,5 -> 8,2")
  (def in "529,822 -> 529,562\n106,230 -> 568,230\n709,377 -> 708,376\n600,544 -> 600,638\n75,351 -> 70,351\n147,959 -> 89,959\n626,911 -> 626,805\n542,816 -> 408,950\n489,224 -> 489,441\n266,583 -> 255,583\n603,145 -> 603,309\n50,871 -> 785,136\n460,412 -> 966,918\n506,920 -> 506,552\n378,515 -> 378,538\n16,467 -> 26,467\n646,219 -> 646,142\n341,461 -> 891,461\n382,253 -> 382,945\n489,344 -> 634,199\n563,19 -> 233,349\n337,894 -> 936,295\n156,413 -> 156,916\n859,986 -> 99,226\n226,768 -> 178,816\n924,58 -> 924,890\n755,236 -> 36,236\n920,399 -> 920,643\n620,12 -> 790,12\n290,236 -> 849,236\n556,649 -> 556,96\n975,195 -> 591,579\n606,438 -> 606,778\n871,203 -> 523,551\n232,521 -> 904,521\n309,206 -> 896,793\n385,988 -> 385,186\n726,974 -> 95,343\n603,336 -> 603,368\n749,184 -> 869,184\n415,558 -> 911,558\n477,550 -> 477,603\n522,415 -> 938,831\n230,951 -> 497,951\n859,275 -> 150,275\n683,455 -> 894,455\n404,42 -> 658,42\n933,767 -> 765,767\n909,298 -> 909,423\n813,312 -> 833,292\n20,15 -> 964,959\n376,362 -> 111,627\n329,336 -> 329,511\n132,915 -> 798,249\n517,560 -> 517,479\n88,595 -> 88,857\n281,678 -> 566,393\n144,961 -> 801,304\n82,871 -> 545,408\n499,849 -> 499,146\n414,785 -> 384,785\n653,839 -> 653,67\n573,634 -> 229,634\n880,283 -> 542,283\n777,189 -> 164,189\n463,97 -> 596,97\n862,865 -> 862,555\n227,780 -> 227,905\n319,214 -> 319,360\n683,569 -> 683,335\n626,703 -> 88,165\n243,810 -> 243,370\n622,506 -> 622,324\n670,151 -> 670,441\n703,808 -> 703,879\n260,597 -> 206,597\n232,13 -> 94,13\n443,680 -> 298,680\n504,368 -> 504,103\n372,341 -> 372,256\n155,799 -> 155,504\n12,47 -> 950,985\n60,500 -> 60,973\n154,783 -> 295,924\n131,348 -> 131,497\n951,388 -> 542,388\n825,164 -> 825,719\n850,351 -> 692,351\n69,955 -> 259,955\n171,701 -> 164,701\n748,457 -> 610,319\n924,170 -> 924,965\n800,599 -> 685,599\n621,40 -> 146,515\n453,423 -> 800,76\n933,394 -> 301,394\n207,647 -> 207,255\n151,568 -> 662,57\n333,763 -> 333,897\n521,847 -> 154,847\n255,696 -> 97,696\n188,687 -> 188,791\n76,382 -> 596,902\n325,637 -> 618,344\n458,949 -> 889,518\n365,136 -> 411,136\n641,248 -> 641,143\n202,518 -> 490,806\n225,40 -> 225,493\n473,311 -> 968,806\n169,854 -> 169,61\n17,887 -> 803,101\n310,766 -> 508,766\n948,12 -> 52,908\n953,739 -> 347,739\n183,727 -> 757,153\n101,21 -> 101,799\n461,619 -> 461,831\n519,390 -> 857,390\n615,860 -> 72,860\n846,87 -> 846,897\n826,896 -> 560,896\n237,206 -> 982,951\n407,825 -> 949,283\n555,705 -> 555,333\n180,101 -> 180,452\n144,31 -> 144,192\n894,175 -> 894,927\n468,57 -> 146,379\n117,66 -> 117,530\n187,748 -> 187,948\n150,232 -> 685,767\n630,249 -> 630,400\n591,679 -> 762,508\n888,177 -> 404,177\n524,692 -> 944,272\n677,104 -> 818,104\n54,232 -> 573,232\n618,629 -> 618,456\n62,128 -> 938,128\n895,113 -> 111,897\n192,165 -> 969,942\n890,896 -> 890,329\n714,643 -> 84,13\n561,268 -> 561,818\n700,534 -> 493,741\n965,582 -> 652,269\n840,526 -> 285,526\n216,86 -> 216,886\n812,275 -> 708,275\n113,902 -> 912,902\n137,173 -> 137,553\n343,598 -> 193,598\n510,380 -> 194,380\n37,974 -> 957,54\n119,801 -> 888,801\n243,11 -> 813,581\n298,463 -> 298,884\n86,869 -> 86,727\n431,899 -> 581,899\n788,862 -> 633,862\n305,781 -> 196,781\n478,421 -> 426,421\n956,47 -> 32,971\n689,802 -> 689,525\n940,94 -> 940,455\n896,207 -> 120,207\n569,360 -> 377,168\n673,281 -> 673,396\n791,839 -> 50,98\n66,787 -> 837,16\n13,887 -> 809,91\n550,745 -> 550,494\n970,901 -> 320,251\n832,49 -> 61,820\n265,577 -> 795,47\n556,211 -> 106,211\n809,216 -> 50,216\n81,630 -> 292,630\n69,973 -> 986,56\n389,240 -> 389,98\n526,748 -> 526,573\n975,885 -> 567,885\n665,492 -> 665,407\n169,726 -> 926,726\n609,896 -> 609,560\n599,398 -> 403,202\n436,367 -> 436,907\n859,268 -> 308,268\n369,331 -> 525,331\n116,19 -> 116,691\n457,845 -> 452,840\n43,117 -> 828,902\n839,938 -> 839,282\n344,154 -> 975,154\n492,952 -> 186,952\n450,94 -> 450,650\n823,897 -> 743,897\n787,112 -> 787,75\n196,921 -> 233,958\n969,976 -> 73,80\n593,873 -> 354,634\n51,838 -> 630,838\n523,822 -> 718,822\n990,235 -> 807,235\n355,789 -> 15,789\n465,919 -> 609,919\n662,185 -> 455,185\n722,406 -> 722,346\n20,283 -> 20,270\n608,440 -> 283,440\n215,756 -> 215,956\n324,275 -> 866,817\n319,181 -> 319,445\n397,272 -> 50,619\n281,354 -> 266,354\n915,858 -> 915,64\n815,723 -> 340,248\n873,760 -> 873,532\n677,145 -> 458,364\n409,106 -> 54,106\n867,585 -> 704,585\n100,617 -> 100,34\n708,707 -> 418,707\n535,812 -> 535,841\n294,571 -> 294,851\n824,590 -> 234,590\n534,317 -> 938,317\n13,133 -> 13,245\n784,74 -> 130,728\n907,916 -> 668,677\n526,767 -> 849,767\n930,96 -> 824,96\n399,33 -> 399,348\n910,404 -> 910,690\n455,348 -> 455,737\n741,464 -> 685,464\n169,296 -> 952,296\n947,388 -> 491,844\n964,336 -> 964,230\n614,71 -> 240,71\n877,957 -> 877,896\n37,381 -> 37,871\n184,772 -> 149,772\n928,120 -> 928,772\n926,434 -> 394,966\n984,130 -> 138,976\n906,346 -> 376,876\n697,220 -> 697,166\n431,301 -> 130,301\n419,549 -> 419,227\n714,14 -> 714,303\n257,644 -> 127,644\n186,950 -> 975,161\n95,671 -> 601,671\n189,109 -> 314,109\n858,701 -> 627,701\n47,155 -> 467,575\n334,767 -> 334,395\n609,482 -> 609,647\n980,334 -> 497,334\n162,723 -> 399,723\n962,961 -> 45,44\n473,296 -> 452,296\n155,49 -> 155,612\n379,497 -> 552,324\n640,606 -> 414,606\n889,604 -> 889,616\n564,273 -> 47,790\n181,770 -> 656,770\n451,281 -> 969,281\n124,289 -> 59,289\n359,106 -> 359,730\n535,644 -> 33,142\n486,651 -> 399,651\n722,453 -> 944,453\n920,46 -> 223,46\n369,954 -> 369,387\n455,430 -> 455,752\n57,22 -> 973,938\n337,887 -> 337,313\n546,586 -> 471,586\n762,908 -> 762,194\n885,259 -> 402,742\n889,348 -> 889,111\n885,963 -> 741,819\n340,72 -> 340,822\n139,683 -> 664,158\n814,28 -> 814,908\n115,623 -> 137,623\n546,69 -> 211,69\n151,620 -> 151,183\n656,674 -> 464,482\n206,445 -> 187,464\n105,375 -> 105,216\n352,952 -> 352,832\n964,840 -> 826,978\n392,201 -> 392,428\n400,536 -> 400,798\n283,62 -> 71,62\n70,818 -> 893,818\n111,252 -> 721,252\n952,101 -> 124,929\n75,248 -> 75,52\n299,83 -> 962,746\n680,344 -> 680,524\n13,987 -> 989,11\n844,809 -> 755,898\n402,294 -> 977,869\n302,403 -> 692,793\n86,11 -> 202,11\n413,766 -> 124,766\n689,146 -> 967,146\n311,88 -> 717,88\n574,810 -> 432,668\n666,330 -> 914,330\n22,988 -> 986,24\n849,921 -> 849,563\n434,441 -> 136,143\n185,896 -> 469,612\n53,553 -> 53,916\n554,51 -> 554,956\n28,116 -> 857,945\n756,933 -> 759,936\n985,953 -> 963,953\n339,396 -> 339,194\n813,763 -> 813,124\n321,561 -> 795,87\n809,759 -> 503,759\n291,94 -> 300,94\n624,652 -> 601,675\n115,461 -> 560,906\n194,653 -> 194,148\n728,695 -> 728,409\n95,472 -> 95,885\n806,503 -> 223,503\n260,610 -> 260,874\n73,130 -> 772,829\n963,15 -> 11,967\n661,409 -> 978,92\n293,982 -> 293,249\n839,17 -> 839,668\n138,518 -> 138,471\n749,348 -> 749,177\n624,176 -> 835,387\n943,88 -> 57,974\n88,610 -> 552,610\n939,500 -> 909,530\n629,48 -> 440,48\n903,612 -> 96,612\n379,914 -> 209,914\n51,22 -> 51,263\n985,975 -> 66,56\n39,120 -> 699,780\n465,93 -> 967,93\n765,954 -> 765,918\n405,315 -> 710,315\n819,881 -> 45,107\n531,111 -> 355,287\n883,443 -> 659,443\n288,46 -> 763,521\n768,615 -> 768,662\n357,53 -> 848,544\n351,782 -> 351,317\n641,944 -> 938,647\n360,905 -> 982,283\n359,117 -> 359,554\n937,467 -> 937,281\n716,963 -> 55,963\n257,299 -> 550,299\n28,14 -> 952,938\n326,988 -> 326,65\n787,227 -> 501,513\n356,162 -> 736,162\n668,562 -> 668,292\n463,850 -> 36,850\n979,105 -> 979,662\n314,24 -> 682,24\n898,406 -> 780,406\n199,43 -> 572,43\n730,120 -> 156,120\n613,573 -> 217,573\n541,489 -> 948,896\n359,921 -> 845,921\n174,365 -> 616,365\n962,179 -> 962,42\n516,92 -> 101,92\n695,233 -> 61,233\n17,24 -> 978,985\n223,409 -> 223,719\n489,815 -> 637,815\n346,249 -> 955,858\n101,687 -> 461,687\n243,427 -> 334,518\n849,915 -> 203,269\n11,758 -> 535,758\n76,788 -> 804,60\n659,343 -> 649,343\n756,602 -> 756,548\n543,593 -> 543,788\n36,65 -> 950,979\n522,96 -> 157,96\n839,600 -> 797,600\n571,704 -> 210,704\n704,361 -> 704,409\n374,799 -> 974,199\n870,826 -> 64,20\n30,618 -> 30,196\n394,260 -> 394,934\n793,65 -> 815,65\n126,769 -> 756,769\n443,636 -> 443,749\n909,573 -> 831,495\n22,884 -> 891,15\n337,286 -> 337,454\n261,607 -> 210,556\n314,837 -> 314,774\n869,432 -> 869,957\n482,81 -> 475,74\n966,94 -> 103,957\n759,102 -> 655,206\n956,95 -> 956,714\n765,681 -> 765,520\n817,959 -> 201,959\n301,378 -> 725,802\n56,867 -> 421,867\n775,657 -> 430,657\n340,57 -> 565,57\n615,632 -> 958,289\n265,342 -> 138,469\n804,654 -> 810,654\n782,306 -> 782,483\n399,683 -> 982,683\n593,781 -> 796,781\n638,752 -> 638,323\n122,243 -> 122,843\n890,83 -> 54,919\n376,552 -> 376,380\n271,403 -> 302,403\n684,221 -> 16,889\n286,618 -> 424,480\n738,693 -> 138,93\n629,750 -> 629,284\n734,364 -> 734,738\n916,934 -> 19,37\n801,342 -> 954,495\n237,516 -> 606,885\n680,591 -> 65,591\n661,230 -> 756,230\n163,371 -> 163,496\n374,759 -> 859,759\n945,513 -> 705,753\n239,517 -> 239,916\n548,796 -> 72,320\n441,351 -> 441,402\n129,315 -> 793,979\n892,137 -> 819,137\n799,957 -> 799,731\n649,468 -> 626,468\n974,299 -> 974,629\n828,954 -> 88,214\n369,277 -> 312,277\n943,360 -> 943,314\n610,644 -> 610,647\n172,913 -> 460,625\n145,61 -> 888,804\n813,693 -> 582,693\n857,848 -> 49,40\n660,252 -> 387,252\n250,723 -> 25,723\n340,186 -> 621,186\n144,96 -> 144,372\n351,804 -> 366,804\n875,600 -> 752,600\n475,490 -> 865,880\n26,46 -> 944,964\n405,712 -> 125,712\n711,676 -> 178,143\n488,446 -> 348,306\n170,440 -> 170,105\n970,981 -> 119,130\n284,772 -> 416,772\n850,148 -> 749,148\n898,955 -> 898,947\n677,109 -> 787,219\n534,650 -> 534,696\n730,216 -> 730,814\n514,89 -> 130,89\n380,199 -> 291,288\n931,110 -> 678,363\n226,537 -> 453,764\n954,228 -> 954,988\n847,338 -> 315,338\n316,989 -> 974,331\n666,554 -> 224,554\n53,868 -> 551,370\n614,548 -> 614,924\n191,837 -> 561,837\n605,639 -> 240,274\n906,28 -> 906,957")
  (part-1 (parse in))
  (part-2 (parse in))
  )
